<form [formGroup]="form" class="grid grid-cols-12 gap-4" (ngSubmit)="onSubmit()">
  <div class="col-span-12">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.name' | translate }}</app-label>
      <input
        pInputText
        type="text"
        class="w-full"
        [formControl]="form.controls.name"
        [placeholder]="'addresses.form.namePlaceholder' | translate"
      />
      <app-control-error [control]="form.controls.name" />
    </app-form-field>
  </div>
  <div class="col-span-4">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.country' | translate }}</app-label>
      <p-select
        class="w-full"
        appendTo="body"
        [options]="countries()"
        [formControl]="form.controls.countryId"
        optionLabel="name"
        optionValue="id"
        [filter]="true"
        filterBy="name"
        (onChange)="onCountrySelect($event)"
      >
        <ng-template let-option #selectedItem>
          <div class="flex items-center gap-1.5">
            <img
              src="https://flagcdn.com/w80/{{ option.iso2.toLowerCase() }}.png"
              style="width: 18px"
            />
            <span>{{ option.name }}</span>
          </div>
        </ng-template>
        <ng-template let-option #item>
          <div class="flex items-center gap-1.5">
            <img
              src="https://flagcdn.com/w80/{{ option.iso2.toLowerCase() }}.png"
              style="width: 18px"
            />
            <span>{{ option.name }}</span>
          </div>
        </ng-template>
      </p-select>
      <app-control-error [control]="form.controls.countryId" />
    </app-form-field>
  </div>
  <div class="col-span-4">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.state' | translate }}</app-label>
      <p-select
        class="w-full"
        [disabled]="!form.controls.countryId.value"
        appendTo="body"
        [options]="states()"
        [formControl]="form.controls.stateId"
        optionValue="id"
        optionLabel="name"
        [filter]="true"
        filterBy="name"
        (onChange)="onStateSelect($event)"
      >
        <ng-template let-option #item>
          <div class="flex items-center gap-1.5">
            <span>{{ option.name }}</span>
          </div>
        </ng-template>
      </p-select>
      <app-control-error [control]="form.controls.stateId" />
    </app-form-field>
  </div>

  <div class="col-span-4">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.locality' | translate }}</app-label>
      <p-autocomplete
        class="w-full"
        appendTo="body"
        [disabled]="!form.controls.stateId.value"
        [dropdown]="true"
        [dropdownMode]="'blank'"
        [suggestions]="filteredLocalities()"
        (completeMethod)="filterLocalities($event)"
        [formControl]="form.controls.locality"
        (onSelect)="onLocalitySelect($event)"
        [optionLabel]="'name'"
        [optionValue]="'id'"
      >
        <ng-template let-option #item>
          <div class="flex items-center gap-1.5">
            <span>{{ option.name }}</span>
          </div>
        </ng-template>
      </p-autocomplete>
      <app-control-error [control]="form.controls.locality" />
    </app-form-field>
  </div>
  <div class="col-span-12 md:col-span-8">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.address' | translate }}</app-label>
      <input pInputText type="text" class="w-full" [formControl]="form.controls.address" />
      <app-control-error [control]="form.controls.address" />
    </app-form-field>
  </div>
  <div class="col-span-12 md:col-span-4">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.zip' | translate }}</app-label>
      <input pInputText type="text" class="w-full" [formControl]="form.controls.postalCode" />
      <app-control-error [control]="form.controls.postalCode" />
    </app-form-field>
  </div>
  <div class="col-span-12">
    <app-form-field class="w-full">
      <app-label>{{ 'addresses.form.directions' | translate }}</app-label>
      <textarea
        pTextarea
        type="text"
        class="w-full"
        [formControl]="form.controls.directions"
        [placeholder]="'addresses.form.directionsPlaceholder' | translate"
      ></textarea>
      <app-control-error [control]="form.controls.directions" />
    </app-form-field>
  </div>
  <div class="col-span-12 app-dialog-actions">
    <p-button
      (onClick)="dialogRef.close()"
      type="button"
      severity="secondary"
      [label]="'common.cancel' | translate"
    />
    <p-button type="submit" [label]="'common.save' | translate" icon="pi pi-save" />
  </div>
</form>
